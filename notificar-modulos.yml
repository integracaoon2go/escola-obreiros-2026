name: Notificar üìò#materiais-dos-modulos

on:
  push:
    paths:
      - 'modulo-*.html'  # Detecta qualquer m√≥dulo novo (modulo-1, modulo-2, etc.)

jobs:
  notificar-modulos:
    runs-on: ubuntu-latest
    steps:
      - name: Extrair nome do m√≥dulo
        id: modulo
        run: |
          MODULO_FILE=$(git diff --name-only HEAD~1 | grep 'modulo-.*\.html' | head -1)
          if [ -n "$MODULO_FILE" ]; then
            MODULO_NAME=$(echo "$MODULO_FILE" | sed 's/modulo-\([0-9]*\)-\(.*\)\.html/\1 - \U\2/')
            echo "modulo_file=$MODULO_FILE" >> $GITHUB_OUTPUT
            echo "modulo_name=$MODULO_NAME" >> $GITHUB_OUTPUT
          else
            echo "modulo_file=modulo-desconhecido.html" >> $GITHUB_OUTPUT
            echo "modulo_name=M√≥dulo Novo" >> $GITHUB_OUTPUT
          fi

      - name: Notificar üìò#materiais-dos-modulos
        run: |
          curl -X POST \
            -H 'Content-type: application/json' \
            -d '{
              "username": "üìö Escola de Obreiros Bot",
              "avatar_url": "https://i.ibb.co/pvs8vvzJ/logo-igreja-removebg-preview.png",
              "embeds": [{
                "title": "üìñ APOSTILA SEMANAL DISPON√çVEL",
                "description": "Confira a apostila e os materiais desta semana!",
                "color": 2186160,
                "fields": [
                  {
                    "name": "‚úÖ Novo Material Liberado",
                    "value": "M√≥dulo ${{ steps.modulo.outputs.modulo_name }} foi publicado na plataforma",
                    "inline": false
                  },
                  {
                    "name": "üìã Formato",
                    "value": "PDF + HTML",
                    "inline": true
                  },
                  {
                    "name": "üì• Download",
                    "value": "[Acessar M√≥dulo](https://integracaoon2go.github.io/escola-obreiros-2026/${{ steps.modulo.outputs.modulo_file }})",
                    "inline": true
                  }
                ],
                "footer": {
                  "text": "Escola de Obreiros ‚Ä¢ Vida Nova Church Piracicaba",
                  "icon_url": "https://i.ibb.co/pvs8vvzJ/logo-igreja-removebg-preview.png"
                },
                "timestamp": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"
              }]
            }' \
            ${{ secrets.DISCORD_WEBHOOK_MATERIAIS }}
